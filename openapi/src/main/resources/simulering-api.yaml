openapi: 3.0.0
info:
  title: Simulering API
  version: 1.0.3
  description: API for å simulere.
  contact:
    name: '#team-dagpenger'
servers:
  - url: https://dp-behandling.intern.dev.nav.no
    description: dev
  - url: https://dp-behandling.intern.nav.no
    description: prod

paths:
  /simulering/beregning:
    put:
      description: Simulerer beregning av et meldekort
      operationId: beregnBehandling
      tags:
        - Beregning
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BeregningRequest'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Beregning'
        default:
          description: Feil ved beregning av meldekort
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/HttpProblem'
components:
  schemas:
    BeregningRequest:
      type: object
      description: |
        Request som beskriver grunnlaget for simulering av beregning.
        Alle feltene er obligatoriske med mindre annet er spesifisert.
      required:
        - terskel
        - stønadsperiode
        - dagsats
        - fastsattVanligArbeidstid
        - egenandel
        - dager
      properties:
        terskel:
          type: array
          description: Terskel (Krav til prosentvis tap av arbeidstid) er gitt i prosent - eksempelvis 40 eller 50 for henholdsvis 40% og 50% tap av arbeidstid
          items:
            type: object
            required:
              - verdi
            properties:
              fom:
                type: string
                format: date
              tom:
                type: string
                format: date
              verdi:
                type: number
                format: double
        stønadsperiode:
          type: object
          description: Antall uker i stønadsperiode kan være 26, 52 eller 104. Kan også være mindre hvis en vil simulere en pågående stønadsperiode. Eksempelvis 1 uke igjen.
          required:
            - fom
            - uker
          properties:
            fom:
              type: string
              format: date
            uker:
              type: integer
        antallMeldekortdager:
          type: number
          description: Antall dager i meldekortperioden. Standard er 14 dager.
          format: integer
        meldekortFom:
          type: string
          description: Startdato for meldekortperioden. Standard er første dag i stønadsperiode.
          format: date
        dagsats:
          type: array
          description: Dagsats er gitt i hele kroner. Er maksimal hva en kan få utbetalt per dag.
          items:
            type: object
            required:
              - verdi
            properties:
              fom:
                type: string
                format: date
              tom:
                type: string
                format: date
              verdi:
                type: number
                format: double
        fastsattVanligArbeidstid:
          type: number
          description: Hva den fastsatte vanlige arbeidstiden er i løpet av en uke. Oppgis i timer. Eksempelvis 37.5 eller 40 for henholdsvis 37.5 og 40 timer per uke.
          format: double
        egenandel:
          type: number
          description: Hvor den egenandelen ligger i kroner. Egenandel trekkes fra i beregningingen. Oppgis i hele kroner.
          format: double
        dager:
          $ref: '#/components/schemas/Dager'

    Dager:
      type: array
      items:
        type: object
        required:
          - dato
          - aktiviteter
          - dagIndex
          - meldt
        properties:
          dato:
            type: string
            format: date
          aktiviteter:
            type: array
            items:
              $ref: '#/components/schemas/Aktivitet'
          dagIndex:
            type: number
          meldt:
            type: boolean
    AktivitetType:
      type: string
      enum:
        - Arbeid
        - Syk
        - Utdanning
        - Fravaer
    Aktivitet:
      required:
        - type
      type: object
      properties:
        id:
          type: string
          format: uuid
        type:
          $ref: '#/components/schemas/AktivitetType'
        timer:
          type: string
          format: ISO8601 Duration
          description: Må representeres som en ISO8601 Duration
      example:
        type: Arbeid
        timer: PT8H30M

    Beregning:
      type: object
      required:
        - dager
        - forbruktEgenandel
        - forbrukt
      properties:
        forbruktEgenandel:
          type: integer
        forbruktKvote:
          type: integer
        dager:
          type: array
          items:
            $ref: '#/components/schemas/BeregningDag'

    BeregningDag:
      type: object
      required:
        - dato
        - dagsats
        - fastsattVanligArbeidstid
        - timerArbeidet
        - forbruktEgenandel
        - utbetalt
      properties:
        dato:
          type: string
          format: date
        dagsats:
          type: integer
        fastsattVanligArbeidstid:
          type: number
          format: double
        timerArbeidet:
          type: number
          format: double
        forbruktEgenandel:
          type: number
          format: int
        utbetalt:
          type: integer

    HttpProblem:
      type: object
      required:
        - type
        - title
        - status
      properties:
        type:
          type: string
          format: uri
          description: A URI reference [RFC3986] that identifies the problem type. This specification encourages that, when dereferenced, it provide human-readable documentation for the problem type
        title:
          type: string
          description: A short, human-readable summary of the problem type. It SHOULD NOT change from occurrence to occurrence of the problem, except for purposes of localization
        status:
          type: integer
          description: The HTTP status code ([RFC7231], Section 6) generated by the origin server for this occurrence of the problem
        detail:
          type: string
          description: A human-readable explanation specific to this occurrence of the problem
        instance:
          type: string
          format: uri
          description: A URI reference that identifies the specific occurrence of the problem. It may or may not yield further information if dereferenced

  securitySchemes:
    azureAd:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Bruker [AzureAD](https://docs.nais.io/security/auth/azure-ad) til autentisering. 
        Token må ha `audience` satt til `[cluster].teamdagpenger.dp-behandling`.
        
        For å teste APIet kan du lage et gyldig OBO-token ved å bruke wonderwalled:
        - [dev-gcp](https://azure-token-generator.intern.dev.nav.no/api/obo?aud=dev-gcp.teamdagpenger.dp-behandling)