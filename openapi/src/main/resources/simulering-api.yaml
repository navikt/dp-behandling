openapi: 3.0.0
info:
  title: Simulering API
  version: 1.0.3
  description: API for å simulere.
  contact:
    name: '#team-dagpenger'
servers:
  - url: https://dp-behandling.intern.dev.nav.no
    description: dev
  - url: https://dp-behandling.intern.nav.no
    description: prod

paths:
  /simulering/beregning:
    put:
      description: Simulerer beregning av et meldekort
      operationId: beregnBehandling
      tags:
        - Beregning
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BeregningRequest'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Beregning'
        default:
          description: Feil ved beregning av meldekort
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/HttpProblem'
components:
  schemas:
    BeregningRequest:
      type: object
      required:
        - terskel
        - stonadsperiode
        - sats
        - fva
        - egenandel
        - meldekort
      properties:
        terskel:
          type: array
          items:
            type: object
            required:
              - verdi
            properties:
              fom:
                type: string
                format: date
              tom:
                type: string
                format: date
              verdi:
                type: number
                format: double
        stonadsperiode:
          type: object
          required:
            - fom
          properties:
            fom:
              type: string
              format: date
            uker:
              type: number
              format: int32
        antallMeldekortdager:
          type: number
          format: int32
        meldekortFom:
          type: string
          format: date
        sats:
          type: array
          items:
            type: object
            required:
              - verdi
            properties:
              fom:
                type: string
                format: date
              tom:
                type: string
                format: date
              verdi:
                type: number
                format: double
        fva:
          type: number
          format: double
        egenandel:
          type: number
          format: double
        meldekort:
          type: array
          items:
            type: object
            required:
              - dag
              - type
              - verdi
            properties:
              dag:
                type: string
              type:
                type: string
                enum: [ "Arbeidstimer", "Fravær", "Sykdom" ]
              verdi:
                type: number
                format: double

    Beregning:
      type: object
      properties:
        gjenståendeEgenandel:
          type: number
          format: double
        kvoteForbruk:
          type: integer
        dager:
          type: array
          items:
            $ref: '#/components/schemas/BeregningDag'

    BeregningDag:
      type: object
      required:
        - dato
        - sats
        - fva
        - timerArbeidet
        - forbruktEgenandel
        - utbetalt
      properties:
        dato:
          type: string
          format: date
        sats:
          type: number
          format: double
        fva:
          type: number
          format: double
        timerArbeidet:
          type: number
          format: double
        forbruktEgenandel:
          type: number
          format: double
        utbetalt:
          type: integer

    HttpProblem:
      type: object
      required:
        - type
        - title
        - status
      properties:
        type:
          type: string
          format: uri
          description: A URI reference [RFC3986] that identifies the problem type. This specification encourages that, when dereferenced, it provide human-readable documentation for the problem type
        title:
          type: string
          description: A short, human-readable summary of the problem type. It SHOULD NOT change from occurrence to occurrence of the problem, except for purposes of localization
        status:
          type: integer
          description: The HTTP status code ([RFC7231], Section 6) generated by the origin server for this occurrence of the problem
        detail:
          type: string
          description: A human-readable explanation specific to this occurrence of the problem
        instance:
          type: string
          format: uri
          description: A URI reference that identifies the specific occurrence of the problem. It may or may not yield further information if dereferenced

  securitySchemes:
    azureAd:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Bruker [AzureAD](https://docs.nais.io/security/auth/azure-ad) til autentisering. 
        Token må ha `audience` satt til `[cluster].teamdagpenger.dp-behandling`.
        
        For å teste APIet kan du lage et gyldig OBO-token ved å bruke wonderwalled:
        - [dev-gcp](https://azure-token-generator.intern.dev.nav.no/api/obo?aud=dev-gcp.teamdagpenger.dp-behandling)